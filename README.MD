# ğŸ˜ï¸ Building Coordinate Extractor

**Extract building coordinates with OpenStreetMap metadata for Australian communities**

A comprehensive tool that combines Microsoft Global Building Footprints with OpenStreetMap data to provide detailed building information for community planning, particularly Starlink coverage analysis for remote Australian communities.

[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![Streamlit](https://img.shields.io/badge/streamlit-1.28+-red.svg)](https://streamlit.io/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## ğŸ¯ Features

### **ğŸ“Š Data Sources**
- **Microsoft Global Building Footprints**: High-accuracy building geometries
- **OpenStreetMap**: Rich metadata (names, amenities, addresses, building types)
- **Nominatim Geocoding**: Address lookup for building locations

### **ğŸ–¥ï¸ Interface Options**
- **ğŸ–±ï¸ Streamlit Web App**: Beautiful, interactive web interface
- **âŒ¨ï¸ Command Line**: Batch processing for automation workflows
- **ğŸ“ Dual Input**: Upload CSV files or enter single communities manually

### **ğŸš€ Smart Performance**
- **âš¡ Intelligent Caching**: 10x faster re-runs with automatic cache management
- **ğŸ“Š Real-time Progress**: Granular progress tracking with dual progress bars
- **ğŸ”„ Resume Capability**: Process interruptions won't lose previous work

### **ğŸ—ï¸ Building Classification**
- **ğŸŸ¢ Residential**: Houses, apartments, cabins (Green markers)
- **ğŸ”´ Community**: Schools, hospitals, churches (Red markers)  
- **ğŸ”µ Commercial**: Shops, offices, warehouses (Blue markers)

### **ğŸ“¤ Output Formats**
- **ğŸ“„ CSV**: For coverage planning software integration
- **ğŸ—ºï¸ KML**: For Google Earth visualization and validation
- **ğŸ“‹ Summary**: Detailed reports with statistics and recommendations
- **ğŸ“¦ ZIP Downloads**: Convenient packaging for sharing

## ğŸ“¸ Screenshots

### Streamlit Web Interface

*Streamlit Web Interface*

![Main Interface](screenshots/streamlit.png)

*Terminal Progress*

![Terminal Progress](screenshots/Terminal.png) 

*Google Earth Interactive Map*

![Google Earth Interactive Map](screenshots/GoogleEarth.png)

*CSV Export*

![CSV Export](screenshots/csvExport.png)


## ğŸš€ Quick Start

### **Installation**

1. **Clone or Download Project Files**
   ```bash
   git clone https://github.com/Jack-B-Hall/BuildingDetector.git building-extractor
   cd building-extractor
   ```

2. **Install Dependencies**
   ```bash
   pip install -r requirements.txt
   ```

3. **Run Streamlit App**
   ```bash
   streamlit run streamlit_app.py
   ```
   
   Or use the demo launcher:
   ```bash
   python run_demo.py
   ```

### **Command Line Usage**

```bash
# Process all communities from CSV
python town_extract.py --batch

# Process single community  
python town_extract.py --lat -12.324 --lon 133.056 --distance 2 --name "Gunbalanya"

# Clear cache when needed
python town_extract.py --clear-cache
```

## ğŸ“ Project Structure

```
building-extractor/
â”œâ”€â”€ ğŸ“± Web Interface
â”‚   â”œâ”€â”€ streamlit_app.py              # Main Streamlit application
â”‚   â””â”€â”€ run_demo.py                   # Quick launcher script
â”‚
â”œâ”€â”€ âŒ¨ï¸ Command Line
â”‚   â””â”€â”€ town_extract.py   # CLI batch processor
â”‚
â”œâ”€â”€ ğŸ§© Core Modules  
â”‚   â”œâ”€â”€ app/utils.py                  # Utility functions & XML escaping
â”‚   â”œâ”€â”€ app/cache_manager.py          # Smart caching system
â”‚   â”œâ”€â”€ app/microsoft_data.py         # Microsoft building data processing
â”‚   â”œâ”€â”€ app/osm_integration.py        # OpenStreetMap metadata integration
â”‚   â””â”€â”€ app/output_generators.py      # CSV, KML, and report generation
â”‚
â”œâ”€â”€ ğŸ“„ Configuration
â”‚   â”œâ”€â”€ requirements.txt              # Python dependencies
â”‚   â”œâ”€â”€ TownData.csv                  # Sample community data
â”‚   â””â”€â”€ README.md                     # This file
â”‚
â”œâ”€â”€ ğŸ“ Generated Data
â”‚   â”œâ”€â”€ output/                       # Processed community results
â”‚   â”‚   â”œâ”€â”€ community_name/
â”‚   â”‚   â”‚   â”œâ”€â”€ community_name_buildings.csv
â”‚   â”‚   â”‚   â”œâ”€â”€ community_name_buildings.kml
â”‚   â”‚   â”‚   â””â”€â”€ community_name_summary.txt
â”‚   â”‚   â””â”€â”€ batch_summary_report.txt
â”‚   â”‚
â”‚   â”œâ”€â”€ cache/                        # Performance cache
â”‚   â”‚   â”œâ”€â”€ osm_metadata.json        # OSM building metadata
â”‚   â”‚   â”œâ”€â”€ geocoding.json           # Address lookups
â”‚   â”‚   â””â”€â”€ buildings.pickle         # Complete building datasets
â”‚   â”‚
â”‚   â””â”€â”€ temp_buildings/               # Temporary QuadKey files (auto-deleted)
```

## ğŸ“‹ CSV Input Format

Your CSV file should contain these columns:

### **Required Columns:**
- `Community Name` (or `town_name`, `name`)
- `Latitude` (or `latitude`, `lat`) 
- `Longitude` (or `longitude`, `lon`)

### **Optional Columns:**
- `distance_km` (search radius, otherwise uses app setting)
- `State`, `LGA`, `ABS Remoteness`, `AGIL CODE` (preserved in output)

### **Example CSV:**
```csv
AGIL CODE,Community Name,Latitude,Longitude,State,LGA,ABS Remoteness
16MI,16 Mile Camp,-23.45764,133.83248,NT,MacDonnell,Remote Australia
GILN,Alkupitja,-23.06533,133.69436,NT,MacDonnell,Remote Australia
ANGU,Angurugu,-13.9822,136.4606,NT,East Arnhem,Very Remote Australia
HERM,Hermannsburg,-23.9417,132.7697,NT,MacDonnell,Remote Australia
```

## ğŸ›ï¸ Usage Guide

### **Streamlit Web App**

1. **ğŸ“ Upload CSV or âœï¸ Manual Entry**
   - Upload your community CSV file, or
   - Enter single community details manually

2. **ğŸ¯ Set Search Radius**
   - Use slider to select 0.5km - 10km radius
   - 2km recommended for most communities

3. **ğŸš€ Process Communities**
   - Click "Process Communities" button
   - Watch real-time progress with detailed updates

4. **ğŸ—ºï¸ Explore Results**
   - Select community from dropdown
   - View interactive map with color-coded buildings
   - Analyze category breakdowns and statistics

5. **ğŸ“¦ Download Results**
   - Download current community or all communities
   - Get ZIP files with CSV, KML, and summary files

### **Command Line Interface**

```bash
# Batch processing with default settings
python town_extract.py --batch --verbose

# Custom input file and search radius
python town_extract.py --batch --input my_communities.csv --default-distance 5

# Single community processing
python town_extract.py \
  --lat -23.45764 \
  --lon 133.83248 \
  --distance 3 \
  --name "16 Mile Camp"

# Cache management
python town_extract.py --clear-cache
python town_extract.py --batch --no-cache  # Fresh data
```

## âš¡ Performance & Caching

### **Cache Benefits**
- **First Run**: Normal speed (builds comprehensive cache)
- **Re-runs**: âš¡ ~10x faster using cached data
- **Mixed Runs**: Fast for cached areas, normal for new areas
- **Auto-Expiry**: Cache expires after 30 days automatically

### **Cache Statistics**
```bash
ğŸ“¦ Cache Performance:
OSM metadata hit rate: 89.3%
Geocoding hit rate: 94.7% 
Building area hit rate: 67.2%
```

### **Performance Tips**
- âœ… **Start Small**: Test with 1-2 communities first
- âœ… **Optimal Radius**: 2km works well for most remote communities
- âœ… **Use Cache**: Don't clear cache unless data seems outdated
- âœ… **Batch Processing**: Upload CSV for multiple communities

## ğŸ› ï¸ Technical Details

### **Data Processing Pipeline**
1. **QuadKey Generation**: Convert lat/lon + radius to Microsoft QuadKey tiles
2. **Data Download**: Fetch Microsoft building footprint files
3. **Geometry Processing**: Extract building centroids and calculate areas  
4. **OSM Enhancement**: Enrich with OpenStreetMap metadata
5. **Geocoding**: Add address information via Nominatim
6. **Classification**: Categorize buildings as Residential/Community/Commercial
7. **Output Generation**: Create CSV, KML, and summary files

### **Building Categories**

| Category | Indicators | Color | Examples |
|----------|------------|-------|----------|
| ğŸŸ¢ **Residential** | `house`, `residential`, `apartments` | Green | Houses, cabins, dormitories |
| ğŸ”´ **Community** | `school`, `hospital`, `place_of_worship` | Red | Schools, churches, clinics |
| ğŸ”µ **Commercial** | `shop`, `office`, `commercial` | Blue | Stores, offices, warehouses |

### **Output File Details**

**CSV Files:**
- `building_id`, `latitude`, `longitude`, `name`, `building_category`
- `amenity`, `building_type`, `address`, `height`, `area_sqm`
- `distance_km`, `confidence`, `description` (aggregated metadata)

**KML Files:**
- Color-coded markers by building category
- Detailed popups with all metadata
- Search center and radius circle
- Organized into folders by category

**Summary Files:**
- Community statistics and category breakdowns
- Distance and size analysis
- Detailed building lists by category
- Recommendations for coverage planning

## ğŸ”§ Troubleshooting

### **Common Issues**

**Import Errors**
```bash
Error importing modules: No module named 'app.utils'
```
âœ… **Solution**: Ensure all module files are in the `app/` subfolder

**Slow Processing**
```bash
Progress bar stuck at 60%...
```
âœ… **Solutions**: 
- First run is slower (builds cache)
- Check internet connection for OSM queries
- Consider smaller search radius for testing

**No Buildings Found**
```bash
âŒ No building data available for community
```
âœ… **Solutions**:
- Verify coordinates are in Australia
- Try increasing search radius
- Some very remote areas have limited Microsoft data

**Memory Issues**
```bash
Memory error during large batch processing
```
âœ… **Solutions**:
- Process smaller batches (10-20 communities)
- Clear cache if very large: `--clear-cache`
- Restart application between large batches

### **Cache Issues**

**Clear Cache When:**
- Data seems outdated (>30 days old)
- Getting inconsistent results
- Cache files corrupted

```bash
# Clear all cache
python town_extract.py --clear-cache

# Or from Streamlit sidebar
Click "ğŸ§¹ Clear Cache" button
```

**Cache Locations:**
- `cache/osm_metadata.json` - OSM building data
- `cache/geocoding.json` - Address lookups  
- `cache/buildings.pickle` - Complete building results

## ğŸ¯ Use Cases

### **Starlink Coverage Planning**
- Import CSV files into coverage planning software
- Prioritize Community buildings (schools, clinics) for coverage
- Use distance data for antenna placement optimization
- Validate with KML files in Google Earth

### **Community Development**
- Identify building density patterns
- Catalog community infrastructure (schools, health facilities)
- Plan utilities and services based on building distribution
- Generate reports for government planning

### **Research & Analysis**
- Study remote community settlement patterns
- Analyze building types and distribution
- Compare communities across regions
- Generate datasets for academic research

## ğŸ¤ Contributing

### **Reporting Issues**
- Check existing issues before creating new ones
- Include error messages and log output
- Specify Python version and operating system
- Provide sample CSV data if relevant

### **Development Setup**
```bash
# Install development dependencies
pip install -r requirements.txt
```

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## ğŸ™ Acknowledgments

- **Microsoft**: Global Building Footprints dataset
- **OpenStreetMap**: Community-generated geographic data
- **Nominatim**: Geocoding services
- **Streamlit**: Web application framework

## ğŸ“ Support

For issues and questions:
1. ğŸ“– Check this README and troubleshooting section
2. ğŸ› Search existing issues on the project repository  
3. ğŸ’¬ Create a new issue with detailed information
4. ğŸ“§ Contact the development team

---

**ğŸ‰ Ready to extract building coordinates for your Australian communities!**

Built with â¤ï¸ for remote community connectivity planning.